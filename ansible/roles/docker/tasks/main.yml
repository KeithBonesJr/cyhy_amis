---
# tasks file for docker

#
# Add the cyhy user to the docker group, if it exists
#
- name: Check if the cyhy user exists
  getent:
    database: passwd
    key: cyhy
    fail_key: no

- name: Add the cyhy user to the docker group
  user:
    name: cyhy
    groups: docker
    append: yes
  when: getent_passwd["cyhy"] != None

#
# Add dev users to the docker group
#
- name: Load users from YML file
  local_action:
    module: include_vars
    file: ../../../../terraform/scripts/user_ssh_setup.yml
    name: ssh_users
  become: no

- name: Add dev users to the docker group
  user:
    name: "{{ item }}"
    groups: docker
    append: yes
  loop: "{{ ssh_users.users | map(attribute='name') | list }}"
