---
# tasks file for bod_docker
- name: Create the /var/cyhy directory
  file:
    path: /var/cyhy
    state: directory
    mode: 0755
    owner: admin
    group: admin

- name: Create the /var/cyhy/orchestrator directory
  file:
    path: /var/cyhy/orchestrator
    state: directory
    mode: 0755
    owner: admin
    group: admin

- name: Download and untar the orchestrator tarball
  unarchive:
    src: https://api.github.com/repos/dhs-ncats/orchestrator/tarball/develop
    dest: /var/cyhy/orchestrator
    remote_src: yes
    owner: admin
    group: admin
    extra_opts:
      - "--strip-components=1"

- name: Copying orchestrator secrets
  copy:
    src: orchestrator_secrets/
    dest: /var/cyhy/orchestrator/secrets
    owner: admin
    group: admin
    mode: 0644

- name: Pull the orchestrator docker images but do not start docker-compose
  docker_service:
    project_src: /var/cyhy/orchestrator
    pull: yes
    stopped: yes

- name: Create the /var/cyhy/cyhy-mailer directory
  file:
    path: /var/cyhy/cyhy-mailer
    state: directory
    mode: 0755
    owner: admin
    group: admin

- name: Download and untar the cyhy-mailer tarball
  unarchive:
    src: https://api.github.com/repos/dhs-ncats/cyhy-mailer/tarball/develop
    dest: /var/cyhy/cyhy-mailer
    remote_src: yes
    owner: admin
    group: admin
    extra_opts:
      - "--strip-components=1"

- name: Copying cyhy-mailer secrets
  copy:
    src: cyhy-mailer_secrets/
    dest: /var/cyhy/cyhy-mailer/secrets
    owner: admin
    group: admin
    mode: 0644

- name: Pull the cyhy-mailer docker image but do not start docker-compose
  docker_service:
    project_src: /var/cyhy/cyhy-mailer
    pull: yes
    stopped: yes
