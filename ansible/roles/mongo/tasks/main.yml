---
# tasks file for mongo
- name: Get mongodb-org GPG key
  apt_key:
    keyserver: keyserver.ubuntu.com
    id: EA312927

- name: Copy sources list for mongodb-org (official MongoDB package repo)
  copy:
    src: mongodb-org-3.2.list
    dest: /etc/apt/sources.list.d
    mode: 0644

- name: Update the cache with the mongodb-org goodness
  apt:
    update_cache: yes

- name: Install mongo
  apt:
    name: mongodb-org=3.2.20
  notify:
    - Enable mongo

- name: Configure mongo service to run after cloud-config
  lineinfile:
    dest: /lib/systemd/system/mongod.service
    regexp: ^After=
    state: present
    line: After=network.target cloud-config.service

# Mongo performs best with XFS filesystems
- name: Install xfsprogs
  apt:
    name: xfsprogs
